# 研究室内のNASをUbuntu上にマウントする

### 手順 0: 必要なパッケージをインストール
```
sudo apt update
sudo apt install cifs-utils
```


### 手順 1: マウントするディレクトリを作成
通常、/mnt ディレクトリ以下にWindowsの各ストレージがマウントされています。ここに、NASをマウントすることにしましょう。
```
sudo mkdir /mnt/nas
```

### 手順 2: 認証情報ファイルの作成
NASにアクセスするためのパスワードなどを記述した隠しファイルを作成します。これを使うと /etc/fstab に直接パスワードを書かずに済み、特殊文字のトラブルも回避できます。

1. ホームディレクトリにファイルを作成します。
```
vim ~/.smbcredentials
```
2. 以下の内容を記述して保存します。NASにアクセスするためのユーザ名とパスワードです、間違えないように。
```
username=XXXXX
password=XXXXX

```
3. 他人に見られないよう権限を変更します。
```
chmod 600 ~/.smbcredentials
```
### 手順 3: UIDとGIDの確認
ターミナルで以下を実行して数字を確認してください（通常は 1000 です）。
```
id -u
id -g
```
### 手順 4: /etc/fstab の編集
1. 設定ファイルをエディタで開きます。
```
sudo vim /etc/fstab
```
2. ファイルの末尾に以下の1行を追加します。※ 注意: uid=1000,gid=1000 の部分は手順3で確認した数字に、/home/「Ubuntu上のユーザ名」/ の部分は実際のホームディレクトリのパスに合わせて書き換えてください。
```
//「NASのIPアドレス」/homes/「NASにログインするユーザ名」 /mnt/nas cifs credentials=/home/「Ubuntu上のユーザ名」/.smbcredentials,vers=3.0,uid=1000,gid=1000,iocharset=utf8,_netdev 0 0
```
ポイント
* credentials=...: 手順1で作ったファイルの絶対パスを指定します（~ は使えません）。
* _netdev: 「ネットワークが繋がってからマウントする」というオプションです。これがないと、ネットワーク未接続時に起動が止まってしまうことがあります。

### 手順 5: テスト（再起動前に必ず実施！）
設定に記述ミスがあると起動時にエラーになる可能性があるため、以下のコマンドでテストします。
```
sudo mount -a
```
エラーが表示されなければ成功です。 もしエラーが出た場合は、/etc/fstab の記述を見直してください。問題なければ、次回WSL起動時から自動的にマウントされます。

### 手順 6: シンボリックリンクの作成
せっかくなので、ホームディレクトリにNASへのシンボリックリンクを作成しておきましょう。
```
ln -s /mnt/nas ./NAS
```
